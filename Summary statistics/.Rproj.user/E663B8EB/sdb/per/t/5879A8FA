{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Summary Statistics\"\noutput:\n  html_document:\n    toc: yes\n  html_notebook:\n    self_contained: yes\n    toc: yes\n---\n\n\n```{r setup, include=FALSE}\nlibrary(pacman)  # You must install pacman if not already installed\n                 # after that the other libraries will install if needed\np_load(ggplot2)\np_load(dplyr)\np_load(Hmisc)\np_load(magrittr)\np_load(tidyr)\np_load(scales)\np_load(htmlwidgets)\np_load(formattable)\np_load(plotly)\n```\n\n```{r load_data, include=FALSE}\n# We will get the data using the eboxr package\npacman::p_load(eboxr)\nattributes <- eboxr_read(\"/Users/curtbergmann/Box Sync/Elicit Education/scholar/summary_statistics/attributes.RDS\",\n           read_fun = readRDS)\noptions(scipen=9)\n```\n\n\nThe homework assignment is to explore a variable in the attributes dataset. I will look at two year\nredemptions.\n\n```{r describe}\ndescribe(attributes$num_redemptions_2yr)\n```\n\nThere are cases with '?' as a value. In case of redemptions it's likely that customers with missing values have never redeemed a flight, so I'll convert these cases to 0. \n\n```{r fix missing}\nattributes_clean <- attributes %>% \n  mutate(num_redemptions_2yr = as.numeric(ifelse(num_redemptions_2yr=='?',0,num_redemptions_2yr)))\n\ndescribe(attributes_clean$num_redemptions_2yr)\n```\n\nThese are likely customers who don't have a loyalty account and so can't redeem. Let's check that out\n\n```{r loylaty}\nattributes_clean %>% \n  group_by(loyalty_status) %>% \n  summarise(min = min(num_redemptions_2yr)\n            , median = median(num_redemptions_2yr)\n            , mean = mean(num_redemptions_2yr)\n            , n = n()) %>% \n  mutate(pct = n / sum(n))\n```\n\nMy suspicion is confirmed. Non-members have never redeemed a flight, and these customers make up 43% of the population.  \n\nLet's look at the overall distribution of this variale\n```{r hist}\nggplot(attributes_clean, aes(num_redemptions_2yr)) +\n  geom_histogram()\n```\n\nThe vast majority of customers have never redeemed a flight in the past two years. So next I'll just look at customer who have redeemed\n\n```{r hist2}\nggplot(attributes_clean %>% filter(num_redemptions_2yr>0), aes(num_redemptions_2yr)) +\n  geom_histogram()\n```\n\nEven in this scenario the distribution is very right skewed.\n\nNext I'll look at how these distributions vary by loyalty_status, first getting the data into a tidy form that's easier to analyze and plot\n```{r tidy}\nattributes_tidy <- attributes_clean %>% \n  select(fake_id, SEGMENT_ASSIGNED, loyalty_status, num_redemptions_2yr) %>% \n  gather(attribute, value, -fake_id, -SEGMENT_ASSIGNED, -loyalty_status)\n```\n\n```{r facet}\nattributes_tidy %>% \n  ggplot(aes(value)) %+% \n  geom_histogram() %+%\n  facet_wrap(~loyalty_status, scales = \"free\")\n```\n\nWe see that all non-members have never redeemed and that the skewness of the redeemption distribution declines as we move from the general populatoin \"rr member\" to the most frequent travelers \"a-list prefered\"\n\nLet's look at the same view by segment\n```{r facet_segment}\nattributes_tidy %>% \n  ggplot(aes(value)) +\n  geom_histogram() +\n  facet_wrap(~SEGMENT_ASSIGNED, scales = \"free\")\n```\n\nSegment 1 has much higher redeemption frequency. Let's look at the quantiles by segment \n\n```{r quantiles}\nattributes_tidy %>% \n  group_by(SEGMENT_ASSIGNED) %>% \n  summarise(quantiles = paste(round(quantile(value, c(0.01, 0.05, 0.5, 0.95, 0.99), na.rm=TRUE), 2), collapse=\",\")\n            , n = n()\n            , redemptions = sum(value)) %>%\n  ungroup() %>% \n  mutate(pct_redemptions = redemptions / sum(redemptions)) %>% \n  extract(quantiles, c(\"q01\", \"q05\", \"q50\", \"q95\", \"q99\")\n          , regex = \"(\\\\d+\\\\.?\\\\d*),(\\\\d+\\\\.?\\\\d*),(\\\\d+\\\\.?\\\\d*),(\\\\d+\\\\.?\\\\d*),(\\\\d+\\\\.?\\\\d*)\")\n```\n\nSegment one is a small portion of shoppers but makes up 64% of all redemptions. Even the lowest quantiles of segment one have redeemed points in the last two years.\n",
    "created" : 1514925796988.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3099999908",
    "id" : "5879A8FA",
    "lastKnownWriteTime" : 1500050157,
    "last_content_update" : 1514925813835,
    "path" : "~/namarks github/Elicit Scholar/Summary statistics/summary statistics hw.Rmd",
    "project_path" : "summary statistics hw.Rmd",
    "properties" : {
        "last_setup_crc32" : "AD5392B3c8f6c146"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}